#!/bin/zsh

INPUT="$1"

# ãƒ•ã‚¡ã‚¤ãƒ« or ãƒ•ã‚©ãƒ«ãƒ€ã‹åˆ¤å®š
if [ -f "$INPUT" ]; then
  SOURCE_DIR=$(dirname "$INPUT")
elif [ -d "$INPUT" ]; then
  SOURCE_DIR="$INPUT"
else
  echo "âŒ ç„¡åŠ¹ãªå…¥åŠ›: $INPUT"
  exit 1
fi

cd "$SOURCE_DIR" || exit

# å‡ºåŠ›å…ˆãƒ•ã‚©ãƒ«ãƒ€
mkdir -p "DJI/Original" "DJI/Stabilized" "GoPro/Original" "GoPro/Stabilized"

# æ‹¡å¼µå­ .mp4 / .mov å¤§æ–‡å­—å¯¾å¿œ
typeset -a files
files=(*.mp4(N) *.MP4(N) *.mov(N) *.MOV(N))

for file in $files; do
  [ -e "$file" ] || continue

  filename_lower=$(echo "$file" | tr '[:upper:]' '[:lower:]')

  # --- DJIåˆ†é¡ ---
  if [[ "$filename_lower" == dji_*stabilized* ]]; then
    mv "$file" "DJI/Stabilized/"
    echo "ğŸ”„ DJIã‚¹ã‚¿ãƒ“ï¼š$file"

  elif [[ "$filename_lower" == dji_* ]]; then
    mv "$file" "DJI/Original/"
    echo "ğŸ“ DJIã‚ªãƒªã‚¸ãƒŠãƒ«ï¼š$file"

  # --- GoProåˆ†é¡ ---
  elif [[ "$filename_lower" == gx* ]]; then
    base="${filename_lower##*/}"
    base_noext="${base%.*}"
    lastchar="${base_noext[-1]}"

    if [[ "$lastchar" == [a-z] ]]; then
      mv "$file" "GoPro/Stabilized/"
      echo "ğŸ”„ GoProã‚¹ã‚¿ãƒ“ï¼š$file"
    else
      mv "$file" "GoPro/Original/"
      echo "ğŸ“ GoProã‚ªãƒªã‚¸ãƒŠãƒ«ï¼š$file"
    fi

  else
    echo "â“ æœªåˆ†é¡ï¼š$file"
  fi
done

echo "âœ… ä»•åˆ†ã‘å®Œäº†"